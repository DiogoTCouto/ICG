<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dodge It!</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    /* --- Styles remain the same as your provided HTML --- */
    body {
      background: linear-gradient(45deg, #1a213a, #2e3350, #1a213a);
      background: url('assets/menu_bg.png') no-repeat center/cover;
      background-size: 200% 200%;
      background-position: center center;
      background-repeat: no-repeat;
      height: 100vh;
      position: relative;
      animation: GradientMove 15s ease infinite;
      position: relative;
      color: #fff;
    }
    @keyframes GradientMove {
      0%   { background-position:   0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position:   0% 50%; }
    }

    /* split menu into two columns */
    .menu-container {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 3rem;
      z-index: 10;
    }

    /* left panel: rotating model */
    .left-panel {
      width: 300px;        /* was 240px */
      height: 300px;       /* was 240px */
      overflow: visible;   /* allow preview to spill out */
    }
    #modelCanvas {
      width: 100%;
      height: 100%;
      display: block;
    }

      /* right panel: title + buttons centered */
     .right-panel {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

        .right-panel .game-title {
          position: static;
          transform: none;
          top: auto;
          left: auto;
          font-size: 6rem;     /* bump up title size */
          margin-bottom: 1.5rem; /* space to buttons */
          pointer-events: none;
        }

        .menu-buttons {
          position: static;
          top: auto;
          left: auto;
          margin: 0;
          padding: 0;
          display: flex;
          flex-direction: column;
          gap: 12px;
        }

        .menu-button {
          padding: 10px 0;
          font-size: 0.9rem; /* Keep font size */
          border-radius: 6px; /* Keep slightly rounded corners */
          border: 1px solid rgba(0, 0, 0, 0.3);
          background: rgba(0, 0, 0, 0.45);
          color: white;
          cursor: pointer;
          transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 0.8px;
          text-align: center;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .menu-button:hover {
          background: rgba(0, 0, 0, 0.6);
          transform: scale(1.04);
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .menu-button:active {
            transform: scale(1);
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Style the Play button differently */
        .menu-button.play {
          background: #4CAF50;
          border-color: #388E3C;
        }

        .menu-button.play:hover {
           background: #5DC061;
           border-color: #4CAF50;
           transform: scale(1.04);
           box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        .menu-button.play:active {
           background: #388E3C;
           transform: scale(1);
           box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }


        /* --- Modal Styling (kept consistent) --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 2000; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease; }
        .modal.active { opacity: 1; }
        .modal-content { background: rgba(42, 42, 48, 0.95); backdrop-filter: blur(8px); border-radius: 10px; padding: 30px 40px; width: 90%; max-width: 550px; position: relative; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); color: white; transform: scale(0.9); opacity: 0; transition: all 0.3s ease-out; border: 1px solid rgba(255, 255, 255, 0.1); }
        .modal.active .modal-content { transform: scale(1); opacity: 1; }
        .close-button { position: absolute; top: 12px; right: 18px; font-size: 26px; font-weight: bold; line-height: 1; cursor: pointer; color: #aaa; transition: color 0.3s; z-index: 1; }
        .close-button:hover { color: white; }
        .modal-title { font-size: 1.7rem; margin-top: 0; margin-bottom: 25px; color: white; text-align: center; font-weight: 700; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .player-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .player-option { border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; transition: all 0.2s; background: rgba(255, 255, 255, 0.05); }
        .player-option:hover { border-color: #4CAF50; background: rgba(76, 175, 80, 0.1); transform: scale(1.03); }
        .player-option.selected { border-color: #4CAF50; background: rgba(76, 175, 80, 0.2); box-shadow: 0 0 10px rgba(76, 175, 80, 0.3); }
        .player-preview { width: 100%; height: 60px; display: flex; justify-content: center; align-items: center; margin-bottom: 10px; font-size: 1.1rem; font-weight: bold; }
        .save-button { width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 6px; font-size: 1.0rem; font-weight: bold; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px; }
        .save-button:hover { background: #43A047; transform: scale(1.02); }
        .controls-content { max-width: 600px; }
        .controls-group { margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.15); padding-bottom: 15px; }
        .controls-group:last-of-type { border-bottom: none; padding-bottom: 0; }
        .controls-group h3 { font-size: 1.1rem; color: #4CAF50; margin-bottom: 10px; }
        .control-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 0.9rem; }
        .key { background: rgba(255,255,255,0.15); padding: 4px 10px; border-radius: 6px; font-family: monospace; font-weight: bold; border: 1px solid rgba(255,255,255,0.2); min-width: 40px; text-align: center; }
        .about-content { text-align: center; }
        .about-content img { max-width: 120px; border-radius: 50%; margin-bottom: 15px; border: 3px solid #4CAF50; }
        .about-content p { font-size: 0.9rem; line-height: 1.6; margin-bottom: 10px; color: #ddd; }
        .about-content p:last-of-type { margin-bottom: 0; }

        /* --- Loading Screen Styling --- */
        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1d; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 3000; opacity: 1; transition: opacity 0.5s ease-out; }
        .loading-icon { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,.2); border-radius: 50%; border-top-color: #4CAF50; animation: spin 1s linear infinite; margin-bottom: 25px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 1.5rem; color: white; margin-bottom: 25px; position: relative; font-weight: 400; letter-spacing: 2px; }
        .loading-text::after { content: ''; position: absolute; right: -20px; animation: dots 1.5s infinite steps(4, end); }
        @keyframes dots { 0%, 100% { content: ''; } 25% { content: '.'; } 50% { content: '..'; } 75% { content: '...'; } }
        .loading-bar-container { width: 250px; height: 8px; background: #333; border-radius: 4px; overflow: hidden; position: relative; }
        .loading-bar { height: 100%; width: 0%; background: #4CAF50; position: absolute; top: 0; left: 0; border-radius: 4px; transition: width 0.3s ease; box-shadow: 0 0 8px rgba(76, 175, 80, 0.5); }

        /* Accessibility */
        button:focus, .player-option:focus { outline: none; box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.5); }

      </style>
</head>
<body>
  <canvas id="background-canvas"></canvas>
  <div class="overlay"></div>

  <div class="loading-screen" id="loadingScreen">
    <div class="loading-icon"></div>
    <div class="loading-text">Loading Game</div>
    <div class="loading-bar-container">
      <div class="loading-bar" id="loadingBar"></div>
    </div>
  </div>

  <div class="menu-container" id="mainMenu">
    <div class="left-panel">
      <canvas id="modelCanvas"></canvas>
    </div>
    <div class="right-panel">
      <div class="game-title">Dodge It!</div>
      <div class="menu-buttons">
      <button class="menu-button play" id="playButton">Play Game</button>
      <button class="menu-button" id="customizeButton">Customize</button>
      <button class="menu-button" id="controlsButton">Controls</button>
      <button class="menu-button" id="viewModeButton">View Mode</button>
      <button class="menu-button" id="aboutButton">About</button>
    </div>
  </div>

  <div class="modal" id="customizeModal">
     <div class="modal-content">
      <span class="close-button" id="closeCustomize">&times;</span>
      <h2 class="modal-title">Customize Player</h2>
      <h3>Style</h3>
      <div class="player-options">
        <div class="player-option selected" data-model="cube"><div class="player-preview">Cube</div></div>
        <div class="player-option" data-model="sphere"><div class="player-preview">Sphere</div></div>
        <div class="player-option" data-model="robot"><div class="player-preview">Robot</div></div>
      </div>
      <button class="save-button" id="saveCustomize">Save & Close</button>
    </div>
  </div>

  <div class="modal" id="controlsModal">
       <div class="modal-content controls-content">
      <span class="close-button" id="closeControls">&times;</span>
      <h2 class="modal-title">Game Controls</h2>
      <div class="controls-group">
        <h3>Movement</h3>
        <div class="control-item"><span>Move Forward</span><span class="key">W</span> / <span class="key">↑</span></div>
        <div class="control-item"><span>Move Left</span><span class="key">A</span> / <span class="key">←</span></div>
        <div class="control-item"><span>Move Backward</span><span class="key">S</span> / <span class="key">↓</span></div>
        <div class="control-item"><span>Move Right</span><span class="key">D</span> / <span class="key">→</span></div>
        <div class="control-item"><span>Jump / Double Jump</span><span class="key">Space</span></div>
      </div>
      <div class="controls-group">
        <h3>Camera & Game</h3>
        <div class="control-item"><span>Toggle First/Third Person</span><span class="key">F</span></div>
        <div class="control-item"><span>Look (First Person)</span><span>Mouse</span></div>
        <div class="control-item"><span>Zoom (Third Person)</span><span>Scroll Wheel</span></div>
        <div class="control-item"><span>Pause / Resume</span><span class="key">ESC</span></div>
      </div>
      <div class="controls-group">
        <h3>Interaction</h3>
        <div class="control-item"><span>Collect Cupcake</span><span>Click</span></div>
      </div>
    </div>
  </div>

  <div class="modal" id="aboutModal">
      <div class="modal-content about-content">
      <span class="close-button" id="closeAbout">&times;</span>
      <h2 class="modal-title">About Dodge It!</h2>
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" alt="Placeholder Image"/>
      <p>Dodge the falling balls while navigating the treacherous terrain! Collect cupcakes for points.</p>
      <p>Built with Three.js & Cannon-es.</p>
      <p>Project for Intro to Computer Graphics.</p>
      <p>Version 1.2.3</p> <p>&copy; 2025 [Your Name/Group Name]</p>
    </div>
  </div>

  <div id="gameContainer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none;">
      </div>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.176.0/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.176.0/examples/jsm/"
    }
  }
  </script>

  <script>
    // Floating cubes background (Remains the same)
    const canvas = document.getElementById('background-canvas');
    const ctx    = canvas.getContext('2d');
    let W, H;
    function resize() {
      W = canvas.width  = window.innerWidth;
      H = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Create some drifting squares
    const cubes = Array.from({length:40}, () => ({
      x: Math.random()*W,
      y: Math.random()*H,
      size: 20 + Math.random()*30,
      speed: 1 + Math.random()*2
    }));

    function draw() {
      ctx.clearRect(0,0,W,H);
      cubes.forEach(c => {
        c.y -= c.speed;
        if (c.y + c.size < 0) c.y = H + c.size;
        ctx.fillStyle = 'rgba(255,255,255,0.03)';
        ctx.fillRect(c.x, c.y, c.size, c.size);
      });
      requestAnimationFrame(draw);
    }
    draw();
    </script>
  <script>
    // --- Menu Interaction and Game Start Logic (Unchanged) ---
    const userPreferences = { playerModel: 'cube', viewMode: false };
    const mainMenu = document.getElementById('mainMenu');
    const customizeModal = document.getElementById('customizeModal');
    const controlsModal = document.getElementById('controlsModal');
    const aboutModal = document.getElementById('aboutModal');
    const loadingScreen = document.getElementById('loadingScreen');
    const loadingBar = document.getElementById('loadingBar');
    const gameContainer = document.getElementById('gameContainer');

    // --- Functions (Unchanged - Full code copied for completeness) ---
    function openModal(modalId) { const modal = document.getElementById(modalId); if (!modal) return; modal.style.display = 'flex'; setTimeout(() => { modal.classList.add('active'); }, 10); }
    function closeModal(modalId) { const modal = document.getElementById(modalId); if (!modal) return; modal.classList.remove('active'); setTimeout(() => { modal.style.display = 'none'; }, 300); }
    function simulateLoading(callback) { loadingScreen.style.display = 'flex'; loadingScreen.style.opacity = '1'; let progress = 0; loadingBar.style.width = '0%'; const interval = setInterval(() => { progress += Math.random() * 10 + 5; if (progress >= 100) { progress = 100; clearInterval(interval); loadingBar.style.width = `${progress}%`; setTimeout(() => { loadingScreen.style.opacity = '0'; setTimeout(() => { loadingScreen.style.display = 'none'; if (callback) callback(); }, 500); }, 400); } else { loadingBar.style.width = `${progress}%`; } }, 150); }
    function startGame(isViewMode) { userPreferences.viewMode = isViewMode; console.log("Starting game with preferences:", userPreferences); if(mainMenu) { mainMenu.style.transition = 'opacity 0.3s ease-out'; mainMenu.style.opacity = '0'; setTimeout(() => { if (mainMenu) mainMenu.style.display = 'none'; }, 300); } else { console.error("Main menu element not found"); } setTimeout(() => { simulateLoading(() => { const params = new URLSearchParams(); params.set('model', userPreferences.playerModel); params.set('viewMode', userPreferences.viewMode); window.location.href = `game.html?${params.toString()}`; }); }, 50); }

     // --- Event Listeners (Unchanged) ---
    document.getElementById('playButton')?.addEventListener('click', () => startGame(false));
    document.getElementById('customizeButton')?.addEventListener('click', () => openModal('customizeModal'));
    document.getElementById('controlsButton')?.addEventListener('click', () => openModal('controlsModal'));
    document.getElementById('viewModeButton')?.addEventListener('click', () => startGame(true));
    document.getElementById('aboutButton')?.addEventListener('click', () => openModal('aboutModal'));
    document.getElementById('closeCustomize')?.addEventListener('click', () => closeModal('customizeModal'));
    document.getElementById('closeControls')?.addEventListener('click', () => closeModal('controlsModal'));
    document.getElementById('closeAbout')?.addEventListener('click', () => closeModal('aboutModal'));
    const playerOptions = document.querySelectorAll('.player-option');
    playerOptions.forEach(option => { option.addEventListener('click', () => { playerOptions.forEach(opt => opt.classList.remove('selected')); option.classList.add('selected'); userPreferences.playerModel = option.getAttribute('data-model'); }); });
    document.getElementById('saveCustomize')?.addEventListener('click', () => { closeModal('customizeModal'); });

     // Initial Setup
    loadingScreen.style.opacity = '0';
    loadingScreen.style.display = 'none';
    if(mainMenu) { mainMenu.style.opacity = '1'; /* mainMenu doesn't need display:flex if children are absolute */ }

  </script>

  <script type="module">
    import * as THREE from 'three'; // Import THREE using the import map

    const modelCanvas = document.getElementById('modelCanvas');
    if (modelCanvas) { // Check if canvas exists
        const renderer  = new THREE.WebGLRenderer({ canvas: modelCanvas, alpha: true, antialias: true });
        const scene     = new THREE.Scene();
        const camera    = new THREE.PerspectiveCamera(45, 1, 0.1, 100);
        camera.position.set(0, 1.2, 5);
        scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 10, 7);
        scene.add(dirLight);
        let previewMesh;

        function makePreview(type) {
          if (previewMesh) scene.remove(previewMesh);
          switch(type) {
            case 'sphere':
              previewMesh = new THREE.Mesh(new THREE.SphereGeometry(1.2,32,32), new THREE.MeshPhongMaterial({color:0x3366ff}));
              break;
            case 'robot':
              previewMesh = new THREE.Group();
              const body = new THREE.Mesh(new THREE.BoxGeometry(1.5,1.5,1.5), new THREE.MeshPhongMaterial({color:0x777777})); previewMesh.add(body);
              const head = new THREE.Mesh(new THREE.SphereGeometry(0.6,16,16), new THREE.MeshPhongMaterial({color:0xaaaaaa})); head.position.set(0,1.2,0); previewMesh.add(head);
              break;
            default: // cube
              previewMesh = new THREE.Mesh(new THREE.BoxGeometry(2,2,2), new THREE.MeshPhongMaterial({color:0x00cc44}));
          }
          scene.add(previewMesh);
        }

        makePreview('cube'); // Initial preview

        // Update preview when customize option changes (listen to the modal's options)
         document.querySelectorAll('.player-option').forEach(option => {
            option.addEventListener('click', () => {
                const modelType = option.getAttribute('data-model');
                if (modelType) {
                    makePreview(modelType);
                }
            });
        });


        const spheres = Array.from({ length: 12 }, () => {
          const mesh = new THREE.Mesh(new THREE.SphereGeometry(0.15,16,16), new THREE.MeshPhongMaterial({color:0xff4444}));
          mesh.position.set((Math.random()-0.5)*1.2, Math.random()*4+1, (Math.random()-0.5)*0.3);
          scene.add(mesh);
          return { mesh, speed: 0.01 + Math.random()*0.02 };
        });

        function animatePreview() {
          requestAnimationFrame(animatePreview);
          if (previewMesh) previewMesh.rotation.y += 0.01;
          spheres.forEach(o => {
            o.mesh.position.y -= o.speed;
            if (o.mesh.position.y < -1) o.mesh.position.y = Math.random()*4+1;
          });
          const w = modelCanvas.clientWidth;
          const h = modelCanvas.clientHeight;
          if (renderer.domElement.width !== w || renderer.domElement.height !== h) {
            renderer.setSize(w, h, false); // false = don't update style
            camera.aspect = w/h;
            camera.updateProjectionMatrix();
          }
          renderer.render(scene, camera);
        }
        animatePreview();
    } else {
        console.warn("modelCanvas element not found.");
    }
  </script>

</body>
</html>